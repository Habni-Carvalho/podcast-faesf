<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Drops de Conhecimento â€“ EpisÃ³dio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Lucide (Ã­cones em linha) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --azul:#001f36;
      --cinza:#f1f1f4;
      --cinza-card:#ffffff;
      --borda:1px solid #e2e2e8;
      --raio:20px;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}

    body{background:#dfe0e5;margin:0}
    header{
      background:var(--azul);color:#fff;padding:28px 8px;
      text-align:center;font-weight:700;font-size:clamp(18px,2.5vw,28px);
      display:flex;justify-content:center;align-items:center;gap:8px
    }
    header svg{stroke:#fff;width:32px;height:32px}

    /* --- barra de aÃ§Ã£o -------------------------------- */
    .action-bar{
      max-width:900px;
      margin:-1.2rem auto 1.2rem;     /* puxa para perto do header */
      padding:.8rem 1rem;             /* altura suficiente pros Ã­cones */
      display:flex;justify-content:space-between;align-items:center;
      background:var(--cinza);border-radius:var(--raio);border:var(--borda);
      z-index:5;position:relative
    }
    .icon-group{display:flex;gap:.9rem}
    .icon-btn{cursor:pointer;display:flex;align-items:center;justify-content:center}
    .icon-btn svg{
      width:26px;height:26px;stroke:var(--azul);stroke-width:2.2;
      transition:.2s;
    }
    .icon-btn:hover svg{opacity:.7}

    /* --- card do episÃ³dio ----------------------------- */
    .card{
      background:var(--cinza-card);border-radius:var(--raio);
      border:var(--borda);max-width:900px;margin:0 auto 4rem;
      padding:2rem;display:flex;gap:1.6rem
    }
    .cover{
      flex:0 0 260px;
      border-radius:var(--raio);object-fit:cover;width:100%;height:auto
    }
    .info{flex:1;display:flex;flex-direction:column;gap:.4rem}
    h1{font-size:clamp(20px,2vw,28px);color:var(--azul);line-height:1.25}
    .meta{font-size:.9rem;color:#555;display:flex;gap:.5rem;align-items:center}
    .meta svg{width:15px;height:15px;stroke:#999}
    p.desc{margin-top:.5rem;font-size:1rem;line-height:1.45;color:#333}

    audio{width:100%;margin-top:1.4rem;border-radius:50px}

    /* --- responsivo ----------------------------------- */
    @media(max-width:720px){
      .card{flex-direction:column;align-items:center;text-align:center}
      .cover{width:100%;max-width:320px}
      .info{align-items:center}
    }
  </style>
</head>
<body>

  <!-- cabeÃ§alho -->
  <header>
    <i data-lucide="headphones"></i>
    Drops de Conhecimento
  </header>

  <!-- barra de aÃ§Ã£o -->
  <div class="action-bar">
    <div class="icon-group">
      <span class="icon-btn" id="btnVoltar" title="Voltar">
        <i data-lucide="chevron-left"></i>
      </span>
    </div>
    <div class="icon-group">
      <span class="icon-btn" id="btnWhats" title="Compartilhar no WhatsApp">
        <i data-lucide="message-circle-more"></i>
      </span>
      <span class="icon-btn" id="btnCopy" title="Copiar link">
        <i data-lucide="copy"></i>
      </span>
    </div>
  </div>

  <!-- card do episÃ³dio (preenchido via JS) -->
  <div class="card" id="episodio">
    <img class="cover" src="" alt="Imagem do episÃ³dio" />
    <div class="info">
      <h1 id="titulo"></h1>
      <div class="meta">
        <i data-lucide="calendar"></i><span id="data"></span>
        <i data-lucide="tag"></i><span id="tag"></span>
      </div>
      <p class="desc" id="descricao"></p>
      <audio controls id="player"></audio>
    </div>
  </div>

  <!-- Firebase + lÃ³gica -->
  <script type="module">
    import { initializeApp }      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCiXyKgy5sw26JWPLZBX6SFVLbBDrLOCZw",
      authDomain: "podcasts-faesf-72959.firebaseapp.com",
      projectId: "podcasts-faesf-72959",
      storageBucket: "podcasts-faesf-72959.appspot.com",
      messagingSenderId: "1097331767383",
      appId: "1:1097331767383:web:7e4228ea735c5365cd4b12"
    };
    const app   = initializeApp(firebaseConfig);
    const db    = getFirestore(app);

    // helper: formata data pt-BR
    const fmt = iso => new Date(iso).toLocaleDateString("pt-BR",{timeZone:"UTC"});

    async function carregar(){
      const id = new URLSearchParams(location.search).get("id");
      if(!id){location.href="index.html";return;}

      const snap = await getDoc( doc(db,"episodios",id) );
      if(!snap.exists()){alert("EpisÃ³dio nÃ£o encontrado");return;}
      const ep = snap.data();

      document.querySelector(".cover").src          = ep.imagem;
      document.getElementById("titulo").textContent = ep.titulo;
      document.getElementById("data").textContent   = fmt(ep.data);
      document.getElementById("tag").textContent    = ep.tag;
      document.getElementById("descricao").textContent = ep.descricao;
      document.getElementById("player").src         = ep.audio;

      // acÃ§Ãµes:
      const linkPag   = location.href;
      document.getElementById("btnVoltar").onclick = () => history.back();
      document.getElementById("btnCopy").onclick   = () =>{
        navigator.clipboard.writeText(linkPag);
        alert("Link copiado!");
      };
      document.getElementById("btnWhats").onclick  = () =>{
        const msg = encodeURIComponent(`ðŸŽ§ ${ep.titulo}\n${linkPag}`);
        window.open(`https://wa.me/?text=${msg}`,"_blank");
      };
    }

    carregar();
  </script>

  <!-- ativa os Ã­cones Lucide -->
  <script>lucide.createIcons();</script>
</body>
</html>
