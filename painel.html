<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel | Podcast FAESF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f6f9;
      color: #333;
    }
    header {
      background-color: #001f36;
      color: white;
      padding: 30px;
      text-align: center;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      padding: 30px;
    }
    h2 {
      margin-top: 0;
    }
    .formulario input,
    .formulario textarea,
    .formulario select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    .btn {
      background-color: #001f36;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn:hover {
      background-color: #003354;
    }
    .btn-small {
      font-size: 12px;
      padding: 6px 12px;
    }
    .btn-small i {
      width: 16px;
      height: 16px;
    }
    .episodio {
      background: #fff;
      border: 1px solid #e1e1e1;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    }
    .episodio img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 20px;
    }
    .episodio-flex {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .conteudo {
      flex: 1;
    }
    .conteudo .titulo {
      font-size: 18px;
      font-weight: bold;
    }
    .conteudo .data {
      font-size: 13px;
      color: #777;
      margin-top: 5px;
    }
    .conteudo .descricao {
      margin: 10px 0;
    }
    .topo-acoes {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .botoes-acoes {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    #filtro {
      margin-bottom: 20px;
    }
    i {
      color: #001f36;
    }
    @media (max-width: 600px) {
      .episodio-flex {
        flex-direction: column;
        align-items: center;
      }
      .episodio img {
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Painel de Epis√≥dios</h1>
  </header>

  <div class="container">
    <div class="topo-acoes">
      <h2>Gerenciar epis√≥dios</h2>
      <button class="btn" onclick="mostrarFormulario()">
        <i data-lucide="square-pen"></i> Novo Epis√≥dio
      </button>
    </div>

    <div class="formulario" id="formulario" style="display: none;">
      <input type="text" id="titulo" placeholder="T√≠tulo do epis√≥dio">
      <textarea id="descricao" placeholder="Descri√ß√£o do epis√≥dio"></textarea>
      <input type="date" id="data">
      <input type="text" id="tag" placeholder="Tag / Playlist">
      <input type="text" id="imagem" placeholder="Link da imagem (.jpg ou .png)">
      <input type="text" id="audio" placeholder="Link do √°udio (.mp3)">
      <button class="btn" onclick="salvarEpisodio()">Salvar</button>
    </div>

    <label for="filtro">Filtrar por tag:</label>
    <select id="filtro" onchange="aplicarFiltro()">
      <option value="">Todas</option>
    </select>

    <div id="lista-episodios"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCiXyKgy5sw26JWPLZBX6SFVLbBDrLOCZw",
      authDomain: "podcasts-faesf-72959.firebaseapp.com",
      projectId: "podcasts-faesf-72959",
      storageBucket: "podcasts-faesf-72959.firebasestorage.app",
      messagingSenderId: "1097331767383",
      appId: "1:1097331767383:web:7e4228ea735c5365cd4b12"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let todos = [];
    let editandoId = null;

    function mostrarFormulario(ep = null, id = null) {
      document.getElementById("formulario").style.display = "block";
      editandoId = id;
      document.getElementById("titulo").value = ep?.titulo || "";
      document.getElementById("descricao").value = ep?.descricao || "";
      document.getElementById("data").value = ep?.data || "";
      document.getElementById("tag").value = ep?.tag || "";
      document.getElementById("imagem").value = ep?.imagem || "";
      document.getElementById("audio").value = ep?.audio || "";
    }

    function limparFormulario() {
      editandoId = null;
      document.getElementById("formulario").style.display = "none";
    }

    function salvarEpisodio() {
      const titulo = document.getElementById("titulo").value.trim();
      const descricao = document.getElementById("descricao").value.trim();
      const data = document.getElementById("data").value;
      const tag = document.getElementById("tag").value.trim();
      const imagem = document.getElementById("imagem").value.trim();
      const audio = document.getElementById("audio").value.trim();

      if (!titulo || !descricao || !data || !imagem || !audio || !tag) {
        alert("Preencha todos os campos.");
        return;
      }

      const episodio = {
        titulo, descricao, data, imagem, audio, tag,
        criadoEm: firebase.firestore.Timestamp.now()
      };

      const ref = db.collection("episodios");
      if (editandoId) {
        ref.doc(editandoId).set(episodio).then(() => {
          carregarEpisodios();
          limparFormulario();
        });
      } else {
        ref.add(episodio).then(() => {
          carregarEpisodios();
          limparFormulario();
        });
      }
    }

    function excluirEpisodio(id) {
      if (confirm("Tem certeza que deseja excluir este epis√≥dio?")) {
        db.collection("episodios").doc(id).delete().then(() => {
          carregarEpisodios();
        });
      }
    }

    function aplicarFiltro() {
      const tagSelecionada = document.getElementById("filtro").value;
      const lista = document.getElementById("lista-episodios");
      lista.innerHTML = "";
      const filtrados = tagSelecionada ? todos.filter(e => e.tag === tagSelecionada) : todos;
      exibirEpisodios(filtrados);
    }

    function carregarEpisodios() {
      const lista = document.getElementById("lista-episodios");
      lista.innerHTML = "";
      const filtro = document.getElementById("filtro");
      filtro.innerHTML = '<option value="">Todas</option>';

      db.collection("episodios").orderBy("criadoEm", "desc").get().then((querySnapshot) => {
        todos = [];
        const tagsSet = new Set();
        querySnapshot.forEach((doc) => {
          const ep = doc.data();
          ep.id = doc.id;
          todos.push(ep);
          tagsSet.add(ep.tag);
        });
        [...tagsSet].sort().forEach(tag => {
          const op = document.createElement("option");
          op.value = tag;
          op.textContent = tag;
          filtro.appendChild(op);
        });
        exibirEpisodios(todos);
      });
    }

    function exibirEpisodios(lista) {
      const listaE = document.getElementById("lista-episodios");
      listaE.innerHTML = "";
      lista.forEach((ep) => {
        const div = document.createElement("div");
        div.className = "episodio";
        div.innerHTML = `
          <div class="episodio-flex">
            <img src="${ep.imagem}" alt="Imagem do epis√≥dio">
            <div class="conteudo">
              <div class="titulo">${ep.titulo}</div>
              <div class="data">üìÖ ${ep.data} | üè∑Ô∏è ${ep.tag}</div>
              <div class="descricao">${ep.descricao}</div>
              <audio controls src="${ep.audio}"></audio>
              <div class="botoes-acoes">
                <button class="btn btn-small" onclick='mostrarFormulario(${JSON.stringify(ep)}, "${ep.id}")'><i data-lucide="square-pen"></i> Editar</button>
                <button class="btn btn-small" onclick='excluirEpisodio("${ep.id}")'><i data-lucide="trash-2"></i> Excluir</button>
              </div>
            </div>
          </div>
        `;
        listaE.appendChild(div);
      });
      lucide.createIcons();
    }

    window.onload = carregarEpisodios;
  </script>
</body>
</html>
